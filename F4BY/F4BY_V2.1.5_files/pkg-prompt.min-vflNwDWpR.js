define("modules/clean/admin/megaphone/prompt/api/utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){var t=function(e){return e.replace(/_(.)/g,function(e,t){return t.toUpperCase()})},n=function(e,t){if(null===t)return null;if(Array.isArray(t)){var o=[];return t.forEach(function(t){o.push(n(e,t))}),o}if("object"==typeof t){var r={};return Object.keys(t).forEach(function(o){r[e(o)]=n(e,t[o])}),r}return t},o=function(e,t){return n(e,t)};e.toCamelCase=function(e){return o(t,e)},e.jsonToCamelCase=function(t){var n=JSON.parse(t);return e.toCamelCase(n)},e.stringToCamelCase=function(e){return t(e)},e.toStoneBool=function(e){return{".tag":"bool",bool:e}},e.toStoneInt=function(e){return{".tag":"int",int:e}},e.toStoneString=function(e){return{".tag":"string",string:e}},e.toStoneStringList=function(e){return{".tag":"string_list",string_list:e}}})(t.APIUtils||(t.APIUtils={})),t.isVersion=function(e){return void 0!==e.id},t.isCreateVersionArg=function(e){return void 0===e.id},t.versionResultToUpdateVersionArg=function(e){return{id:e.id,content_dict:e.content_dict,description:e.description,name:e.name,stormcrow_variant:e.stormcrow_variant}},t.isAdActive=function(e){return!!e.ad&&!!e.ad.lifecycle_state&&"active"===e.ad.lifecycle_state[".tag"]},t.isCampaignArchived=function(e){return"archived"===e.lifecycle_state[".tag"]},t.isCampaignApproved=function(e){return"approved"===e.lifecycle_state[".tag"]},t.isVersionApproved=function(e){return"approved"===e.lifecycle_state[".tag"]},t.isVersionArchived=function(e){return"archived"===e.lifecycle_state[".tag"]},t.isVersionPending=function(e){return"pending_approval"===e.lifecycle_state[".tag"]},t.newIsVersionPending=function(e){var t=e.megaphone_version_metadata,n=t?t.approval_request:void 0;return"pending_approval"===e.lifecycle_state[".tag"]&&void 0!==n&&"pending_approval"===n.lifecycle_state[".tag"]},t.isVersionDraft=function(e){var t=e.megaphone_version_metadata,n=t?t.approval_request:void 0;return"pending_approval"===e.lifecycle_state[".tag"]&&(void 0===n||"draft"===n.lifecycle_state[".tag"])}}),define("modules/clean/react/prompt/header_bubble",["require","exports","tslib","react","external/classnames","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/prompt/header_link","modules/clean/react/prompt/image","modules/clean/react/prompt/button"],function(e,t,n,o,r,i,a,s,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),r=n.__importDefault(r);var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.state_manager.onShow()},t.prototype.render=function(){var e=this.props.campaign.content,t=o.default.createElement("div",null,o.default.createElement("p",{className:"message",dangerouslySetInnerHTML:c.sanitizeOptionalHTML(e.text),ref:this.state_manager.enhanceHTMLButtons}),o.default.createElement(c.PromptButtons,{campaign:this.props.campaign,confirmIsPost:this.state_manager.shouldConfirmUsingPost(),confirmUrl:this.state_manager.buildConfirmEndpointURI(),onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss})),n=r.default({"header-bubble-container":!0,show:!0,"header-bubble-container--with-image":!!e.imageUrl}),i=e.imageUrl?[o.default.createElement("div",{className:"left"},o.default.createElement(c.ConfirmButton,{className:"image-button",confirmInNewTab:e.confirmInNewTab,confirmUrl:this.state_manager.buildConfirmEndpointURI(),confirmIsPost:this.state_manager.shouldConfirmUsingPost(),onConfirm:this.state_manager.onConfirm},o.default.createElement(p.Image,{src:e.imageUrl,srcHiRes:e.imageUrlHiRes,alt:e.confirmText}))),o.default.createElement("div",{className:"right"},t)]:[t],a=["top-level-nav-item"];return this.state.isConfirmed||this.state.isDismissed||a.push("active"),o.default.createElement("li",{className:a.join(" ")},o.default.createElement(s.HeaderLinkRendererWithoutCSS,{content:e,confirmUrl:this.state_manager.buildConfirmEndpointURI(),onConfirm:this.state_manager.onConfirm}),o.default.createElement("div",{className:"sub-nav chat-bubble header-bubble upsell-bubble",id:"upsell-bubble"},o.default.createElement("div",{className:n},i,o.default.createElement("div",{className:"chat-bubble-arrow-border"}),o.default.createElement("div",{className:"chat-bubble-arrow"}))))},t.displayName="HeaderBubbleWithoutCSS",t})(a.PromptLocationWithDefaultState);t.HeaderBubbleWithoutCSS=l,t.HeaderBubble=i.requireCssWithComponent(l,["/static/css/upsell/prompt_pagelet-vfl3PgHRM.css"])}),define("modules/clean/react/prompt/header_link",["require","exports","tslib","react","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/sprite_div"],function(e,t,n,o,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),a=n.__importDefault(a);var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.content,t=["confirm-button","header-nav-link","enabled"];e.linkPretext&&t.push("header-nav-link--bold");var n;n=e.linkIcon?o.default.createElement("a",{className:t.join(" "),href:this.props.confirmUrl,onClick:this.props.onConfirm},o.default.createElement(a.default,{group:"web",name:e.linkIcon,text:e.linkText})):o.default.createElement("a",{className:t.join(" "),href:this.props.confirmUrl,onClick:this.props.onConfirm},e.linkText);var r=n;return e.linkPretext&&(r=o.default.createElement("div",{className:"header-nav-link--space"},o.default.createElement("span",{className:"header-link__pretext"},e.linkPretext),n)),o.default.createElement("div",{className:"header-link"},r)},t.displayName="HeaderLinkRendererWithoutCSS",t})(o.default.Component);t.HeaderLinkRendererWithoutCSS=s;var p=r.requireCssWithComponent(s,["/static/css/upsell/prompt_pagelet-vfl3PgHRM.css"]),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.state_manager.onShow()},t.prototype.render=function(){return o.default.createElement("li",{className:"top-level-nav-item"},o.default.createElement(p,{content:this.props.campaign.content,confirmUrl:this.state_manager.buildConfirmEndpointURI(),onConfirm:this.state_manager.onConfirm}))},t})(i.PromptLocationWithDefaultState);t.HeaderLink=c}),define("modules/clean/react/prompt/home_modal",["require","exports","tslib","react","external/classnames","modules/core/i18n","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/prompt/image","modules/clean/react/modal","modules/clean/react/prompt/button","modules/clean/user_education/user_education_client","modules/clean/user_education/user_education_loader","modules/clean/upsell/prompt_event_logger","modules/clean/ux_analytics_utils"],function(e,t,n,o,r,i,a,s,p,c,l,m,u,d,f){"use strict";function _(e){m.UEClient.sendEvent("OnboardingPromptModal","Shown",{name:e})}function g(e){m.UEClient.sendEvent("OnboardingPromptModal","ConfirmButtonClicked",{name:e})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),r=n.__importDefault(r);var h=function(e){var t=o.default.createElement(c.Modal,{id:e.id,className:e.className,title:e.title,acceptButtonText:e.acceptButtonText,clickOutToClose:!1,showX:e.showX,shouldLoadCss:!1},e.children),n=t.type.prototype;return n.componentDidMount&&(n._componentDidMount=n.componentDidMount,delete n.componentDidMount),t},v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onShow=function(){t.state_manager.onShow(),t.props.campaign.onboardingModuleName&&_(t.props.campaign.onboardingModuleName)},t.onConfirm=function(e){t.state_manager.onConfirm(e),t.props.campaign.content.confirmInNewTab?setTimeout(function(){t.close()},0):t.state_manager.shouldConfirmUsingPost()||(t.close(),t.props.campaign.onboardingModuleName&&(g(t.props.campaign.onboardingModuleName),t.state_manager.eventLogger.recordEvent("onboarding_confirmed"))),f.dispatchModalClosed()},t.onDismiss=function(e){t.state_manager.onDismiss(e),t.close()},t.onRemindMeLater=function(e){t.state_manager.onDismiss(e,{remindMeLater:!0}),t.close()},t.enhanceHTMLButtons=function(e){t.state_manager.enhanceHTMLButtons(e,{dismissButtonSelector:".dismiss-button, .db-modal-x, .db-modal-overlay",onConfirmOverride:t.onConfirm,onDismissOverride:t.onDismiss})},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.props.campaign.onboardingModuleName?u.UELoader.notifyModuleToLoad(this.props.campaign.onboardingModuleName):u.UELoader.notifyModuleToLoad(null)},t.prototype.close=function(){c.Modal.close()},t.prototype.render=function(){var e,t=r.default((e={"dfb-modal":"dfb"===this.props.campaign.campaignTypeId,"pro-modal":"dfb"!==this.props.campaign.campaignTypeId},e["db-modal-custom-"+this.props.campaign.campaignName]=!!this.props.campaign.campaignName,e[this.props.campaign.content.modalStyle||""]=!!this.props.campaign.content.modalStyle,e["show-upsell-modal"]=!0,e)),i={id:this.props.campaign.modalId,className:t,title:this.props.campaign.content.title,clickOutToClose:!0,acceptButtonText:null,showX:!0,isPreview:this.props.isPreview||!1},a=this.props.isPreview?h:c.Modal,s=this.props.isPreview?{}:{onDismiss:this.onDismiss,onShow:this.onShow};return o.default.createElement(a,n.__assign({},i,s),this.renderImage(),this.renderSubtext(),this.renderButtons(),this.renderBottomText())},t.prototype.renderButtons=function(){return o.default.createElement(l.PromptButtons,{campaign:this.props.campaign,confirmIsPost:this.state_manager.shouldConfirmUsingPost(),confirmUrl:this.state_manager.buildConfirmEndpointURI(),onConfirm:this.onConfirm,onDismiss:this.onDismiss,onRemindMeLater:this.onRemindMeLater})},t.prototype.renderImage=function(){return this.props.campaign.content.imageUrl?o.default.createElement(p.Image,{src:this.props.campaign.content.imageUrl,srcHiRes:this.props.campaign.content.imageUrlHiRes,alt:this.props.campaign.content.confirmText||i._("Main modal image.")}):void 0},t.prototype.renderBottomText=function(){return this.props.campaign.content.bottomText?o.default.createElement("div",{className:"bottom-text",dangerouslySetInnerHTML:l.sanitizeOptionalHTML(this.props.campaign.content.bottomText),ref:this.enhanceHTMLButtons}):void 0},t.prototype.renderSubtext=function(){return o.default.createElement("div",{className:"subtext",dangerouslySetInnerHTML:l.sanitizeOptionalHTML(this.props.campaign.content.subtext),ref:this.enhanceHTMLButtons})},t.displayName="HomeModalWithoutCSS",t})(s.PromptLocationWithDefaultState);t.HomeModalWithoutCSS=v,t.HomeModalWithCSS=a.requireCssWithComponent(v,["/static/css/modal-vflKK1XSJ.css","/static/css/upsell/prompt_pagelet-vfl3PgHRM.css","/static/css/upsell/upsell_modal-vflSz0X3p.css"]);var I=(function(e){function r(i){var a=e.call(this,i)||this;if(r.shouldDisplayHomeModal(i)){var s=o.default.createElement(t.HomeModalWithCSS,n.__assign({},i,{ref:a.props.refCallback}));c.Modal.showInstance(s)}else r.kickstartOnboarding(i);return a}return n.__extends(r,e),r.prototype.render=function(){return null},r.shouldDisplayHomeModal=function(e){return!(!e||!e.campaign)&&!(e.campaign.isHomeOnboardingEnabled&&e.campaign.onboardingModuleName&&["home_v1","home_v0"].indexOf(e.campaign.onboardingModuleName)===-1)},r.kickstartOnboarding=function(e){if(!e||!e.campaign)return void u.UELoader.notifyModuleToLoad(null);e.campaign.onboardingModuleName?(u.UELoader.notifyModuleToLoad(e.campaign.onboardingModuleName),_(e.campaign.onboardingModuleName),g(e.campaign.onboardingModuleName)):u.UELoader.notifyModuleToLoad(null);var t=new d.PromptEventLogger(e);t.recordClientImpression(),t.recordConfirm(),t.recordEvent("onboarding_confirmed_no_prompt")},r})(o.default.PureComponent);t.HomeModal=I}),define("modules/clean/upsell/exception",["require","exports","tslib","modules/core/exception","modules/core/xhr"],function(e,t,n,o,r){"use strict";function i(e){var t=e.severity,n=void 0===t?o.SEVERITY.CRITICAL:t;r.sendXhr("/prompt/log_jse",{severity:n})}function reportException(e){var n=e.err,r=e.tags,i=void 0===r?[]:r,a=e.severity,s=void 0===a?o.SEVERITY.CRITICAL:a,p=e.exc_extra,c=void 0===p?{}:p;i.push(t.TAGS.PROMPT),i.push(t.TAGS.MEGAPHONE),o.reportException({err:n,tags:i,severity:s,exc_extra:c}),t.logExceptionRate({severity:s})}function a(e){var n=e.err,r=e.js_controller_options,i=void 0===r?{}:r,a=e.severity,s=void 0===a?o.SEVERITY.CRITICAL:a,p=e.tags,c=void 0===p?[]:p,l={"campaign-name":"campaignName",location:"campaignLocationId"};for(var m in l)if(l.hasOwnProperty(m)){var u=l[m],d=i[u];d&&c.push("prompt-"+m+"-"+d)}t.reportException({err:n,tags:c,severity:s,exc_extra:i})}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.SEVERITY=o.SEVERITY,t.TAGS={MEGAPHONE:"megaphone",PROMPT:"prompt",PROMPT_ADMIN:"prompt-admin",PROMPT_INIT:"prompt-init",LEGACY_TOP_NOTIFICATIONS:"legacy-top-notifications"},t.logExceptionRate=i,t.reportException=reportException,t.reportJsControllerException=a}),define("modules/clean/upsell/prompt_event_logger",["require","exports","tslib","jquery","modules/clean/ajax","modules/clean/upsell/legacy_prompt_event_logging"],function(e,t,n,o,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),r=n.__importStar(r);var a=(function(){function e(e){this.campaignProps=e}return e.prototype.recordClientImpression=function(){var e=this.getUpsellControllerURI("/prompt/log_impression");this.recordAck(e)},e.prototype.recordConfirm=function(){var e=this.getUpsellControllerURI("/prompt/confirm");this.recordAck(e,"db:prompt:confirm")},e.prototype.recordDismiss=function(e){var t=this.getUpsellControllerURI("/prompt/dismiss",{remindMeLater:e});this.recordAck(t,"db:prompt:dismiss")},e.prototype.recordEvent=function(e){var t=this.getUpsellControllerURI("/prompt/log_event",{eventName:e});this.recordAck(t)},e.prototype.recordAck=function(e,t){var n=this;r.SilentBackgroundRequest({type:"POST",url:e.toString()}).done(function(e){t&&n.triggerExternalEvent(t)})},e.prototype.getUpsellControllerURI=function(e,t){return i.getUpsellControllerURI(e,{campaignId:this.campaignProps.campaign.campaignId,versionId:this.campaignProps.campaign.versionId,activeUserId:this.campaignProps.subjectUser,promptQueriedAtMs:this.campaignProps.promptQueriedAtMs,requestId:this.campaignProps.requestId,csrfToken:this.campaignProps.csrfToken,csrfTokenType:this.campaignProps.csrfTokenType,eventName:t&&t.eventName,remindMeLater:t&&t.remindMeLater})},e.prototype.triggerExternalEvent=function(e){o.default(document).trigger(e,{campaignName:this.campaignProps.campaign.campaignName})},e})();t.PromptEventLogger=a}),define("modules/clean/upsell/upsell_controller",["require","exports","tslib","jquery","modules/clean/ajax","modules/clean/upsell/exception","modules/clean/upsell/legacy_prompt_event_logging","modules/core/dom","modules/core/uri"],function(e,t,n,o,r,i,a,s,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),r=n.__importStar(r),i=n.__importStar(i),s=n.__importStar(s);var c=(function(){function e(t,n,r){var i=this;this._keydown=this._keydown.bind(this),this.dismiss=this.dismiss.bind(this),this.confirm=this.confirm.bind(this),this.post_dismiss=this.post_dismiss.bind(this),this.post_confirm=this.post_confirm.bind(this),this.options=r,t.length>0&&t.one("click",function(e){return i.confirm(e)}),n.length>0&&n.one("click",function(e){var t=o.default(e.target).hasClass("remind-me-later");return i.dismiss(e,t)}),this.options.dismissWithKeys&&o.default(document).on("keydown",this._keydown),e.add_tk_params(t,{addTkParams:this.options.addTkParams,campaignId:this.options.campaignId,versionId:this.options.versionId,campaignLocationTkId:this.options.campaignLocationTkId}),t.add(n).addClass("enabled")}return e.initClass=function(){this.CONFIRM="confirm",this.DISMISS="dismiss",this.LOG_IMPRESSION="log_impression"},e.prototype._keydown=function(e){if(27===e.keyCode||8===e.keyCode&&!s.focus_in_input())return e.preventDefault(),o.default(document).off("keydown",this._keydown),this.dismiss(e)},e.prototype._campaignUrl=function(t,n){var o=(function(){return t===e.CONFIRM?"/prompt/confirm":t===e.DISMISS?"/prompt/dismiss":t===e.LOG_IMPRESSION?"/prompt/log_impression":void 0})();if(this.options&&this.options.campaignId){var r=new p.URI({path:o}).updateQuery({campaign_id:this.options.campaignId});return this.options.versionId&&r.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),t===e.DISMISS&&n&&r.updateQuery({remind_me_later:!0}),r.toString()}},e.prototype._confirmOrDismiss=function(e,t,n,i){var a=this;return"keydown"===e.type||n||(e.stopImmediatePropagation(),e.preventDefault()),r.SilentBackgroundRequest({type:"POST",url:t,subject_user:this.options.activeUserId||this.options.subjectUser,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}}).done(function(t){return"keydown"===e.type||n||e.target.click(),o.default(document).trigger(i,a.options)})},e.prototype.dismiss=function(t,n){var r=this._campaignUrl(e.DISMISS,n);return r&&this._confirmOrDismiss(t,r,!1,"db:prompt:dismiss"),o.default(document).trigger("db:prompt:pre-dismiss",this.options)},e.prototype.confirmUrl=function(e){var t=o.default(e.currentTarget);return(function(){return t.is("button, input")&&"submit"===t.attr("type")?o.default(e.currentTarget).closest("form").attr("action"):t.is("a")?o.default(e.currentTarget).attr("href"):void 0})()||this.options.confirmUrl},e.prototype.confirmInNewTab=function(e){var t=o.default(e.currentTarget),n=(function(){return t.is("button, input")&&"submit"===t.attr("type")?o.default(e.currentTarget).closest("form").attr("target"):t.is("a")?o.default(e.currentTarget).attr("target"):void 0})();return n?"_blank"===n:this.options.confirmInNewTab},e.prototype.confirm=function(t){var n=this._campaignUrl(e.CONFIRM);return n&&this._confirmOrDismiss(t,n,this.confirmInNewTab(t),"db:prompt:confirm"),o.default(document).trigger(a.LEGACY_EVENT_PRE_CONFIRM,this.options)},e.prototype.get_time_since_request_start=function(){if(window.performance&&window.performance.timing&&window.performance.timing.navigationStart)return(new Date).getTime()-window.performance.timing.navigationStart},e.prototype.log_impression=function(){var t=this._campaignUrl(e.LOG_IMPRESSION);if(t)return r.SilentBackgroundRequest({type:"POST",url:t,subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},e.prototype.log_event=function(e){if(this.options&&this.options.campaignId){var t=new p.URI({path:"/prompt/log_event"}).updateQuery({event_name:e,campaign_id:this.options.campaignId});return this.options.versionId&&t.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),r.SilentBackgroundRequest({type:"POST",url:t.toString(),subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})}},e.prototype.post_dismiss=function(){var e=this._dismissUrl();if(e)return r.SilentBackgroundRequest({type:"POST",url:e,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},e.prototype.post_confirm=function(){var e=this._confirmUrl();if(e)return r.SilentBackgroundRequest({type:"POST",url:e,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},e.add_tk_params=function(e,t){if(t.addTkParams){if(!t.campaignId||!t.campaignLocationTkId){var n=new Error("Missing campaignId or campaignLocationTkId.");return void i.reportJsControllerException({err:n,js_controller_options:t,severity:i.SEVERITY.NONCRITICAL})}return e.each(function(e,n){var r,i=o.default(n);i.is("a")?r="href":(i=i.closest("form"),r="action");var a=i.attr(r);if(i.length>0&&a){var s=p.URI.parse(a);return s.updateQuery({_tk:t.campaignLocationTkId,_camp:t.versionId||t.campaignId}),i.attr(r,s.toString())}})}},e.register_custom_controller=function(e){var t=e.on_show,n=e.on_confirm,r=e.on_dismiss,i=e.pre_confirm,s=e.pre_dismiss;if(t&&o.default(document).on(a.LEGACY_EVENT_SHOW,t),n&&o.default(document).on(a.LEGACY_EVENT_CONFIRM,n),r&&o.default(document).on(a.LEGACY_EVENT_DISMISS,r),i&&o.default(document).on(a.LEGACY_EVENT_PRE_CONFIRM,i),s)return o.default(document).on(a.LEGACY_EVENT_PRE_DISMISS,s)},e.unregister_custom_controller=function(e){var t=e.on_show,n=e.on_confirm,r=e.on_dismiss,i=e.pre_confirm,s=e.pre_dismiss;if(t&&o.default(document).off(a.LEGACY_EVENT_SHOW,t),n&&o.default(document).off(a.LEGACY_EVENT_CONFIRM,n),r&&o.default(document).off(a.LEGACY_EVENT_DISMISS,r),i&&o.default(document).off(a.LEGACY_EVENT_PRE_CONFIRM,i),s)return o.default(document).off(a.LEGACY_EVENT_PRE_DISMISS,s)},e})();c.initClass(),t.default=c});
//# sourceMappingURL=pkg-prompt.min.js-vflzOynLy.map